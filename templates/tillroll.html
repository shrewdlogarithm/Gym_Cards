<head>
  {% include 'head.j2' %}
  <link rel="stylesheet" href="tillroll.css">
  <script src="tree.js"></script>
  <script>
    $(document).ready(function(){
      function nodeExpand() {

      }
      function nodeCollapse() {

      }
      $("#treedemo").treetable({ expandable: true,
        onNodeExpand:   nodeExpand,
        onNodeCollapse: nodeCollapse });
    })
  </script>
</head>
<body>
  {% include 'toplayout.j2' %}
  <table class="treetable" id="treedemo">
    <thead>
      <th></th>
      {% for type in tilldata.ttypes %}
        <th>{{ type }}</th>
      {% endfor %}
    </thead>
    <tbody>
      {% for tdate in tilldata.tilltrans %}
        {% set date_loop = loop %}
        <tr data-tt-id="{{ date_loop.index }}">
          <td>{{ tdate }}</td>
          {% for type in tilldata.ttypes %}
              <td>{{ tilldata.tilltrans[tdate]["tots"][type] }}</td>
            {% endfor %}
        </tr>
        {% for ttime in tilldata.tilltrans[tdate]["times"] %}
          {% set time_loop = loop %}
          <tr data-tt-id="{{ date_loop.index }}{{ time_loop.index }}" data-tt-parent-id="{{ date_loop.index }}">
            <td>{{ ttime }}</td>              
            {% for type in tilldata.ttypes %}
              <td>{{ tilldata.tilltrans[tdate]["times"][ttime]["tots"][type] }}</td>
            {% endfor %}
          </tr>
          {% for ttrans in tilldata.tilltrans[tdate]["times"][ttime]["trans"] %}
            <tr data-tt-id="{{ date_loop.index }}{{ time_loop.index }}{{ loop.index }}" data-tt-parent-id="{{ date_loop.index }}{{ time_loop.index }}">
              <td>{{ ttrans["label"] }}</td>
              {% for type in tilldata.ttypes %}
                <td>
                {% if type == ttrans["type"] %}
                  {{ ttrans["price"] }}
                {% endif %}
                </td>
              {% endfor %}
            </tr>
          {% endfor %}
        {% endfor %}
      {% endfor %}
    </tbody>
  </table>
</body>
